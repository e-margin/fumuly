## 厳守ルール（コーディング実行の判断基準）

以下のルールは必ず守ること。違反は許容されない。

### コーディングを行わないケース

1. **ユーザーが質問している場合**
   - 「〜ですか？」「〜はどうなっていますか？」などの質問には回答のみを行う
   - 質問への回答と同時にコーディングを行うことは禁止

2. **ユーザーが検討・相談している場合**
   - 「検討しましょう」「考えてみましょう」「どうしようか」などの表現がある場合
   - 選択肢の提示や議論のみを行い、コーディングは行わない

3. **開発内容が確定していない場合**
   - 複数のアプローチがあり、どれを採用するか決まっていない
   - ユーザーの承認・決定を待っている状態

### コーディングを行うケース

- ユーザーが明確に「〜を実装してください」「〜を修正してください」「〜を作ってください」と指示した場合
- 開発内容が確定し、ユーザーの承認を得た後

### 判断に迷った場合

- コーディングを行わず、ユーザーに確認を取る
- 「〜を実装してよろしいですか？」と明示的に許可を求める

---

## セッション跨ぎの引き継ぎルール（必須）

新しいセッションの冒頭でユーザーが前回のやり取りを共有した場合、以下を厳守すること。

### 引き継ぎ時にやること

1. **共有された内容をすべて正確に把握する**
   - 前回のやり取りの一部だけを拾って作業を始めることは禁止
   - 「実装の指示」だけでなく「相談・検討・議論の内容」も同等に重要な文脈として扱う
   - 未決定事項や保留事項があればそれも引き継ぐ

2. **把握した内容をユーザーに要約して確認する**
   - 「前回のセッションから以下を引き継ぎました」と要約を提示する
   - 要約には以下を含める：
     - 作業の進捗状況（完了済み・途中・未着手）
     - 相談・検討中だった事項とその結論または未決定の状態
     - 次にやるべきこと
   - ユーザーの確認を得てから作業を開始する

### やってはいけないこと

- **一部だけ拾って即座にコーディングを始める**（例：POST APIの修正依頼が3件あるのに1件だけ対応する）
- **相談ベースの話を「指示ではない」として無視する**（検討中の内容も文脈として保持する）
- **前回の文脈を無視して、新規の質問として扱う**

---

# Fumuly（フムリー）開発ガイド

## プロダクトの本質

Fumulyは「封筒無理ー！」を解決するアプリ。ただの情報登録アプリではない。
ADHDを抱えて一人で生活するユーザーの「家族のような存在」になることが目的。

Fumulyの価値は「書類を登録した後」にこそある。
書類のまとめツールではなく、ユーザーの状況を理解して道を示すAI。
スキャンは入口であって、本質はチャットによる継続的な伴走。

開発中は常に以下を意識すること：
- **語りかけるトーン**: 機械的な通知ではなく、横にいる人が話しかけるように
- **一画面一アクション**: 選択肢を増やさない。「これだけやればいい」を提示する
- **電話を勧めない**: Web・コンビニ・郵送など代替手段を必ず優先する
- **深刻な状況でも寄り添う**: 差押・督促でも事実を穏やかに伝え、次の行動を示す
- **「読まなくていい」も立派な回答**: DMや不要な書類は明確にそう伝えてユーザーの負荷を下げる
- **登録後の相談こそ本番**: 「期限近いのあったっけ？」「残金10万しかない」に答えられなければアプリの意味がない

## 設計ドキュメント

`docs/` フォルダに要件定義・技術メモ・デザイン設計など全ドキュメントがある。
実装前に必ず参照すること。

## 技術スタック

- Next.js（App Router） + Tailwind CSS + shadcn/ui
- Supabase（PostgreSQL + Auth）
- Claude API（Vision解析）
- Vercel（ホスティング）
- PWA対応

## Supabase DB操作

スキーマ変更（ALTER TABLE, CREATE POLICY等）はSupabase Management APIで実行する。

```bash
curl -s -X POST \
  "https://api.supabase.com/v1/projects/ecrzbrgtrgyoybvaxfbr/database/query" \
  -H "Authorization: Bearer $SUPABASE_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"query": "SQL文"}'
```

- アクセストークンはメモリファイルに保存済み
- `supabase/schema.sql` を更新した際は、Management APIで実際のDBにも適用すること
- ユーザーにSQL Editorでの手動実行を依頼しないこと

---

# タスク管理について

このプロジェクトでは `tasks/` フォルダでMarkdownベースのタスク管理を行っています。

## タスクファイルの形式

各タスクは `tasks/task-XXX.md` に1ファイル1タスクで管理されています。

```markdown
---
id: task-001
title: タスクのタイトル
parents: [カテゴリA, カテゴリB]
status: in-progress
priority: medium
depends_on: [task-002, task-003]
this_week: true
completed_at: null
progress: 70
note: 一行メモ
estimated_hours: 4
---

## 本文（Markdown自由記述）
詳細な説明、設計メモ、参考リンクなど
```

## 優先度一覧

| 優先度 | 意味 |
|--------|------|
| `critical` | 最優先で対応が必要 |
| `high` | 優先的に対応 |
| `medium` | 通常の優先度（デフォルト） |
| `low` | 余裕があるときに対応 |

## ステータス一覧

| ステータス | 意味 |
|-----------|------|
| `idea` | アイデア段階 |
| `waiting` | 着手待ち |
| `in-progress` | 進行中 |
| `blocked` | ブロック中（依存タスクが未完了等） |
| `done` | 完了 |
| `omit` | やらないことに決定 |

## Gitコミット

- コミットメッセージは日本語で書くこと
- 開発が完了するたびにコミット＆プッシュを行うこと（ユーザーに確認不要）

## レビュー

- 開発が完了しコミットした後、レビューエージェント（superpowers:code-reviewer）を回すこと
- レビューで指摘された問題は修正してから再度コミット＆プッシュすること

## Claudeへの指示

### タスクの確認
作業前に `tasks/` フォルダの内容を確認し、現在の状況を把握してください。

### タスクの更新
作業が完了したら、該当タスクのフロントマターを更新してください:
- `status` を適切な値に変更
- `progress` を更新（0-100）
- 完了時は `status: done`、`completed_at: YYYY-MM-DD`、`progress: 100` に設定
- 完了時は本文に作業メモ（行ったこと・設計書等）を追記

### 新規タスクの作成
新しいタスクが必要な場合:
1. 既存のIDの最大値+1で `task-XXX.md` を作成
2. 上記フォーマットに従ってフロントマターを記述
3. `parents` には既存のカテゴリを使用（新規も可）
4. 前提タスクがあれば `depends_on` に記載
5. なるべく新しい開発や修正がある時はタスクを新規で作成してください

### 進捗報告
`this_week: true` のタスクが今週の作業対象です。作業後は進捗率を更新してください。
